# Oasis è°ƒè¯•æ¨¡å¼åŠŸèƒ½æŒ‡å—

## æ¦‚è¿°

è°ƒè¯•æ¨¡å¼æ˜¯ Oasis ç›®æ ‡æ£€æµ‹ç³»ç»Ÿçš„ä¸€ä¸ªé‡è¦åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·åœ¨æ²¡æœ‰ Kinect 2.0 è®¾å¤‡çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ç”µè„‘æ‘„åƒå¤´è¿›è¡Œç›®æ ‡æ£€æµ‹ã€‚è¿™ä¸ªåŠŸèƒ½åŸºäº `main.py` çš„ä»£ç é›†æˆåˆ°å›¾å½¢ç•Œé¢ä¸­ï¼Œä¸ºå¼€å‘å’Œæµ‹è¯•æä¾›äº†ä¾¿åˆ©ã€‚

## ä¸»è¦ç‰¹æ€§

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- **ç”µè„‘æ‘„åƒå¤´æ”¯æŒ**: ä½¿ç”¨å†…ç½®æˆ–å¤–æ¥ USB æ‘„åƒå¤´
- **å¤šæ‘„åƒå¤´é€‰æ‹©**: æ”¯æŒæ‘„åƒå¤´ç´¢å¼• 0, 1, 2 çš„åˆ‡æ¢
- **å®æ—¶ç›®æ ‡æ£€æµ‹**: ä¸ Kinect æ¨¡å¼ç›¸åŒçš„ YOLO æ£€æµ‹èƒ½åŠ›
- **æ¨¡å¼æ— ç¼åˆ‡æ¢**: å¯åœ¨ Kinect å’Œè°ƒè¯•æ¨¡å¼é—´å¿«é€Ÿåˆ‡æ¢

### ğŸ”§ æŠ€æœ¯å®ç°
- **CameraThread ç±»**: ä¸“é—¨çš„ç”µè„‘æ‘„åƒå¤´è§†é¢‘å¤„ç†çº¿ç¨‹
- **OpenCV é›†æˆ**: ä½¿ç”¨ cv2.VideoCapture è¿›è¡Œæ‘„åƒå¤´æ§åˆ¶
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„æ‘„åƒå¤´é”™è¯¯æ£€æµ‹å’Œç”¨æˆ·åé¦ˆ
- **æ€§èƒ½ä¼˜åŒ–**: 30FPS é‡‡æ ·ç‡ï¼Œ640x480 é»˜è®¤åˆ†è¾¨ç‡

## ç•Œé¢æ“ä½œ

### 1. æ¨¡å¼é€‰æ‹©
åœ¨æ§åˆ¶é¢æ¿çš„"æ£€æµ‹æ¨¡å¼"ç»„ä¸­ï¼š
- **Kinect 2.0 æ¨¡å¼**: ä½¿ç”¨ Kinect æ·±åº¦ç›¸æœº
- **è°ƒè¯•æ¨¡å¼ (ç”µè„‘æ‘„åƒå¤´)**: ä½¿ç”¨ç”µè„‘æ‘„åƒå¤´

### 2. æ‘„åƒå¤´é€‰æ‹©
å½“é€‰æ‹©è°ƒè¯•æ¨¡å¼æ—¶ï¼Œä¼šæ˜¾ç¤ºæ‘„åƒå¤´é€‰æ‹©ä¸‹æ‹‰æ¡†ï¼š
- **æ‘„åƒå¤´ 0**: é€šå¸¸æ˜¯å†…ç½®æ‘„åƒå¤´
- **æ‘„åƒå¤´ 1**: ç¬¬ä¸€ä¸ªå¤–æ¥æ‘„åƒå¤´
- **æ‘„åƒå¤´ 2**: ç¬¬äºŒä¸ªå¤–æ¥æ‘„åƒå¤´

### 3. æ£€æµ‹æ§åˆ¶
- **å¼€å§‹æ£€æµ‹**: å¯åŠ¨é€‰å®šæ¨¡å¼çš„æ£€æµ‹
- **åœæ­¢æ£€æµ‹**: åœæ­¢å½“å‰æ£€æµ‹å¹¶é‡Šæ”¾èµ„æº
- **æ¨¡å¼åˆ‡æ¢**: è‡ªåŠ¨åœæ­¢å½“å‰æ£€æµ‹å¹¶åˆ‡æ¢æ¨¡å¼

## æŠ€æœ¯æ¶æ„

### CameraThread ç±»
```python
class CameraThread(QThread):
    """ç”µè„‘æ‘„åƒå¤´è§†é¢‘å¤„ç†çº¿ç¨‹ï¼ˆè°ƒè¯•æ¨¡å¼ï¼‰"""
    frame_ready = pyqtSignal(np.ndarray)
    detection_ready = pyqtSignal(list)
    error_occurred = pyqtSignal(str)
```

#### ä¸»è¦æ–¹æ³•
- `set_model(model)`: è®¾ç½® YOLO æ¨¡å‹
- `set_camera_index(index)`: è®¾ç½®æ‘„åƒå¤´ç´¢å¼•
- `set_target_classes(classes)`: è®¾ç½®æ£€æµ‹ç±»åˆ«
- `run()`: ä¸»å¾ªç¯ï¼Œå¤„ç†è§†é¢‘å¸§å’Œæ£€æµ‹
- `stop()`: åœæ­¢çº¿ç¨‹å¹¶é‡Šæ”¾æ‘„åƒå¤´

#### æ ¸å¿ƒæµç¨‹
1. **åˆå§‹åŒ–æ‘„åƒå¤´**: `cv2.VideoCapture(camera_index)`
2. **è®¾ç½®å‚æ•°**: åˆ†è¾¨ç‡ã€å¸§ç‡ç­‰
3. **è§†é¢‘å¾ªç¯**: è¯»å–å¸§ â†’ YOLO æ£€æµ‹ â†’ å‘é€ç»“æœ
4. **é”™è¯¯å¤„ç†**: æ‘„åƒå¤´å¼‚å¸¸æ—¶å‘é€é”™è¯¯ä¿¡å·

### é›†æˆåˆ°ä¸»çª—å£

#### ä¿¡å·è¿æ¥
```python
# æ§åˆ¶é¢æ¿ä¿¡å·
self.control_panel.debug_mode_changed.connect(self.on_debug_mode_changed)
self.control_panel.camera_index_changed.connect(self.on_camera_index_changed)

# æ‘„åƒå¤´çº¿ç¨‹ä¿¡å·
self.camera_thread.frame_ready.connect(self.update_video_display)
self.camera_thread.detection_ready.connect(self.update_detections)
self.camera_thread.error_occurred.connect(self.on_camera_error)
```

#### æ£€æµ‹å¯åŠ¨é€»è¾‘
```python
def start_detection(self):
    if self.debug_mode:
        # è°ƒè¯•æ¨¡å¼ï¼šä½¿ç”¨ç”µè„‘æ‘„åƒå¤´
        self.camera_thread = CameraThread()
        self.camera_thread.set_model(self.model)
        self.camera_thread.set_camera_index(self.control_panel.get_camera_index())
        self.camera_thread.start()
    else:
        # Kinect æ¨¡å¼
        self.video_thread = VideoThread()
        # ... Kinect åˆå§‹åŒ–
```

## ä¸ main.py çš„å…³ç³»

### æºä»£ç é›†æˆ
è°ƒè¯•æ¨¡å¼çš„åŠŸèƒ½ç›´æ¥é›†æˆäº† `main.py` çš„æ ¸å¿ƒé€»è¾‘ï¼š

#### main.py åŸå§‹ä»£ç 
```python
# åˆå§‹åŒ–æ‘„åƒå¤´
cap = cv2.VideoCapture(0)

while True:
    ret, frame = cap.read()
    results = model(frame, verbose=False)
    
    # å¤„ç†æ£€æµ‹ç»“æœ
    for r in results:
        for box in r.boxes:
            # ç»˜åˆ¶è¾¹ç•Œæ¡†å’Œæ ‡ç­¾
```

#### é›†æˆåˆ° CameraThread
```python
def run(self):
    self.camera = cv2.VideoCapture(self.camera_index)
    
    while self.running:
        ret, frame = self.camera.read()
        
        # å‘é€åŸå§‹å¸§
        self.frame_ready.emit(frame.copy())
        
        # æ‰§è¡Œæ£€æµ‹
        if self.model:
            results = self.model(frame, verbose=False)
            detections = self.process_detections(results)
            self.detection_ready.emit(detections)
```

### åŠŸèƒ½å¢å¼º
ç›¸æ¯”åŸå§‹çš„ `main.py`ï¼Œè°ƒè¯•æ¨¡å¼æä¾›äº†ä»¥ä¸‹å¢å¼ºï¼š

1. **GUI é›†æˆ**: ä¸å†æ˜¯ç‹¬ç«‹çš„çª—å£ï¼Œé›†æˆåˆ°ä¸»ç•Œé¢
2. **å¤šæ‘„åƒå¤´**: æ”¯æŒå¤šä¸ªæ‘„åƒå¤´è®¾å¤‡é€‰æ‹©
3. **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯åé¦ˆæœºåˆ¶
4. **é…ç½®åŒæ­¥**: ä½¿ç”¨ç»Ÿä¸€çš„é…ç½®ç®¡ç†ç³»ç»Ÿ
5. **æ¨¡å¼åˆ‡æ¢**: å¯ä¸ Kinect æ¨¡å¼æ— ç¼åˆ‡æ¢

## ä½¿ç”¨åœºæ™¯

### 1. å¼€å‘æµ‹è¯•
- **ç®—æ³•è°ƒè¯•**: æ— éœ€ Kinect è®¾å¤‡å³å¯æµ‹è¯•æ£€æµ‹ç®—æ³•
- **ç•Œé¢å¼€å‘**: éªŒè¯ UI ç»„ä»¶çš„æ­£ç¡®æ€§
- **é…ç½®æµ‹è¯•**: æµ‹è¯•ä¸åŒçš„æ£€æµ‹å‚æ•°è®¾ç½®

### 2. æ¼”ç¤ºå±•ç¤º
- **ä¾¿æºæ€§**: åœ¨æ²¡æœ‰ Kinect çš„ç¯å¢ƒä¸­è¿›è¡Œæ¼”ç¤º
- **å…¼å®¹æ€§**: é€‚ç”¨äºå„ç§ç”µè„‘è®¾å¤‡
- **å¿«é€Ÿå¯åŠ¨**: æ— éœ€å¤æ‚çš„ç¡¬ä»¶è®¾ç½®

### 3. æ•™å­¦åŸ¹è®­
- **å­¦ä¹ å·¥å…·**: ç†è§£ç›®æ ‡æ£€æµ‹çš„åŸºæœ¬åŸç†
- **å®éªŒå¹³å°**: è¿›è¡Œè®¡ç®—æœºè§†è§‰ç›¸å…³å®éªŒ
- **æˆæœ¬é™ä½**: æ— éœ€æ˜‚è´µçš„ Kinect è®¾å¤‡

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æ‘„åƒå¤´æ— æ³•æ‰“å¼€
**ç—‡çŠ¶**: æ˜¾ç¤º "æ— æ³•æ‰“å¼€æ‘„åƒå¤´ X"

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥æ‘„åƒå¤´æ˜¯å¦è¢«å…¶ä»–åº”ç”¨å ç”¨
- å°è¯•åˆ‡æ¢åˆ°ä¸åŒçš„æ‘„åƒå¤´ç´¢å¼•
- ç¡®è®¤æ‘„åƒå¤´é©±åŠ¨ç¨‹åºæ­£å¸¸

#### 2. æ‘„åƒå¤´æƒé™é—®é¢˜
**ç—‡çŠ¶**: æ‘„åƒå¤´æ‰“å¼€ä½†æ— æ³•è¯»å–å¸§

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ç³»ç»Ÿæ‘„åƒå¤´æƒé™è®¾ç½®
- åœ¨ macOS ä¸Šå…è®¸åº”ç”¨è®¿é—®æ‘„åƒå¤´
- åœ¨ Windows ä¸Šæ£€æŸ¥éšç§è®¾ç½®

#### 3. æ£€æµ‹æ€§èƒ½é—®é¢˜
**ç—‡çŠ¶**: æ£€æµ‹é€Ÿåº¦æ…¢æˆ–å¡é¡¿

**è§£å†³æ–¹æ¡ˆ**:
- é™ä½æ‘„åƒå¤´åˆ†è¾¨ç‡
- å‡å°‘æ£€æµ‹ç±»åˆ«æ•°é‡
- è°ƒé«˜ç½®ä¿¡åº¦é˜ˆå€¼

#### 4. æ£€æµ‹æ•ˆæœå·®
**ç—‡çŠ¶**: æ£€æµ‹ä¸å‡†ç¡®æˆ–æ¼æ£€

**è§£å†³æ–¹æ¡ˆ**:
- æ”¹å–„å…‰ç…§æ¡ä»¶
- è°ƒæ•´æ‘„åƒå¤´è§’åº¦å’Œè·ç¦»
- é™ä½ç½®ä¿¡åº¦é˜ˆå€¼
- æ¸…æ´æ‘„åƒå¤´é•œå¤´

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½

#### 1. æ‰©å±•æ‘„åƒå¤´æ§åˆ¶
```python
# åœ¨ CameraThread ä¸­æ·»åŠ æ–°çš„æ‘„åƒå¤´å‚æ•°
self.camera.set(cv2.CAP_PROP_BRIGHTNESS, brightness)
self.camera.set(cv2.CAP_PROP_CONTRAST, contrast)
```

#### 2. å¢åŠ æ£€æµ‹åå¤„ç†
```python
def process_detections(self, results):
    detections = []
    for r in results:
        for box in r.boxes:
            # æ·»åŠ æ–°çš„åå¤„ç†é€»è¾‘
            detection = self.apply_custom_filter(box)
            if detection:
                detections.append(detection)
    return detections
```

#### 3. è‡ªå®šä¹‰é”™è¯¯å¤„ç†
```python
def handle_camera_error(self, error_type, error_message):
    if error_type == "permission_denied":
        self.error_occurred.emit("æ‘„åƒå¤´æƒé™è¢«æ‹’ç»")
    elif error_type == "device_busy":
        self.error_occurred.emit("æ‘„åƒå¤´è¢«å…¶ä»–åº”ç”¨å ç”¨")
```

### æ€§èƒ½ä¼˜åŒ–

#### 1. å¸§ç‡æ§åˆ¶
```python
# åœ¨ run() æ–¹æ³•ä¸­è°ƒæ•´å»¶è¿Ÿ
self.msleep(33)  # 30 FPS
self.msleep(66)  # 15 FPS (æ›´çœèµ„æº)
```

#### 2. åˆ†è¾¨ç‡ä¼˜åŒ–
```python
# è®¾ç½®è¾ƒä½åˆ†è¾¨ç‡ä»¥æé«˜æ€§èƒ½
self.camera.set(cv2.CAP_PROP_FRAME_WIDTH, 320)
self.camera.set(cv2.CAP_PROP_FRAME_HEIGHT, 240)
```

#### 3. æ£€æµ‹é¢‘ç‡æ§åˆ¶
```python
# ä¸æ˜¯æ¯å¸§éƒ½è¿›è¡Œæ£€æµ‹
self.frame_count += 1
if self.frame_count % 3 == 0:  # æ¯3å¸§æ£€æµ‹ä¸€æ¬¡
    results = self.model(frame, verbose=False)
```

## æ€»ç»“

è°ƒè¯•æ¨¡å¼ä¸º Oasis ç›®æ ‡æ£€æµ‹ç³»ç»Ÿæä¾›äº†é‡è¦çš„å¼€å‘å’Œæµ‹è¯•æ”¯æŒï¼š

### âœ… ä¼˜åŠ¿
- **è®¾å¤‡ç‹¬ç«‹**: æ— éœ€ä¸“é—¨çš„ Kinect è®¾å¤‡
- **æˆæœ¬ä½å»‰**: ä½¿ç”¨å¸¸è§çš„ç”µè„‘æ‘„åƒå¤´
- **æ˜“äºä½¿ç”¨**: å›¾å½¢ç•Œé¢æ“ä½œç®€å•
- **åŠŸèƒ½å®Œæ•´**: æ”¯æŒæ‰€æœ‰æ£€æµ‹åŠŸèƒ½

### ğŸ“Š æŠ€æœ¯ç‰¹ç‚¹
- **å¤šçº¿ç¨‹**: ç‹¬ç«‹çš„æ‘„åƒå¤´å¤„ç†çº¿ç¨‹
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
- **é…ç½®åŒæ­¥**: ä¸ä¸»ç³»ç»Ÿé…ç½®ä¿æŒä¸€è‡´
- **æ€§èƒ½ä¼˜åŒ–**: é€‚åˆå®æ—¶æ£€æµ‹çš„å‚æ•°è®¾ç½®

### ğŸš€ åº”ç”¨ä»·å€¼
- **å¼€å‘æ•ˆç‡**: åŠ é€Ÿç®—æ³•å¼€å‘å’Œæµ‹è¯•
- **éƒ¨ç½²çµæ´»**: é€‚åº”ä¸åŒçš„ç¡¬ä»¶ç¯å¢ƒ
- **æ•™å­¦æ”¯æŒ**: é™ä½å­¦ä¹ å’Œå®éªŒé—¨æ§›
- **æ¼”ç¤ºä¾¿åˆ©**: éšæ—¶éšåœ°è¿›è¡Œç³»ç»Ÿæ¼”ç¤º

è°ƒè¯•æ¨¡å¼çš„æˆåŠŸé›†æˆä½¿ Oasis æˆä¸ºäº†ä¸€ä¸ªæ›´åŠ å®Œæ•´å’Œå®ç”¨çš„ç›®æ ‡æ£€æµ‹ç³»ç»Ÿï¼Œä¸ºç”¨æˆ·æä¾›äº†å¤šæ ·åŒ–çš„ä½¿ç”¨é€‰æ‹©ã€‚
